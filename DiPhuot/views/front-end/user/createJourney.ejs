<% include ../layout/head %>
  <% include ../layout/header %>
    <div id="content-block">
      <div class="container be-detail-container">
        <form action="/insertPlace" class="form-horizontal" method="POST" enctype="multipart/form-data">
          <div class="row">
            <div class="col-xs-12 col-md-8 left-feild">
              <div style="background-color: rgb(183, 211, 250);" class="container">
                <div style="text-align: center" class="header-page">
                  <br>
                  <span>
           							<h2><i class="fa fa-heart"></i> THÊM ĐỊA ĐIỂM</h2>
									   <span style="font-style: italic;">Những địa điểm - cảnh đẹp bạn đã khám phá chưa có trên ĐiPhượt.com ? Cùng nhau chia sẻ nào!</span>
                  </span>
                </div>
                <hr>
                <div class="col-xs-12 col-md-10">
                  <div class="form-group">
                    <label class="col-sm-3 control-label">Tên địa điểm</label>
                    <div class="col-sm-9">
                      <input required="Nhập tên địa điểm" maxlength="100" id="txtNamePlace" type="text" class="form-control" name="txtNamePlace"
                        placeholder="Tên địa điểm">
                      <span style="color: red; font-style: italic;" id="valName"></span>
                      <br>
                    </div>
                    <label class="col-sm-3 control-label">Loại hình phượt</label>
                    <div class="col-sm-9">
                      <div class="form-checkbox">
                        <label class="checkbox-inline">
                          <input id="cbTreckking" name="cbTreckking" type="checkbox" >Treckking
                        </label>
                        <label class="checkbox-inline">
                          <input id="camping" name="camping" type="checkbox" >Cắm trại
                        </label>
                        <label class="checkbox-inline">
                          <input id="seeView" name="seeView" type="checkbox" >Ngắm cảnh
                        </label>
                        <label class="checkbox-inline">
                          <input id="cbClaimb" name="cbClaimb" type="checkbox" >Leo núi
                        </label>
                      </div>
                      <span style="color: red; font-style: italic;" id="valCheckbox"></span>
                      <br>
                    </div>
                    <label class="col-sm-3 control-label">Địa chỉ</label>
                    <div class="col-sm-9">
                      <input maxlength="100" required="Nhập địa chỉ" id="txtAddress" type="text" class="form-control" name="txtAddress" placeholder="Địa chỉ">
                      <span style="color: red; font-style: italic;" id="valAddress"></span>
                      <input placeholder="Search địa điểm" id="input" type="text" class="col-sm-4" style="font-family: Comic Sans MS, cursive, sans-serif; font-size: 13pt;margin: 10px; border: 1px solid transparent; border-radius: 2px 0 0 2px; box-sizing: border-box; -moz-box-sizing: border-box;"
                      />
                      <br>
                    </div>
                    <div class="row">
                      <label for="inputPassword" class="col-sm-3 control-label">Tỉnh thành</label>
                      <div class="col-sm-2">
                        <select id="ddlCity" onchange="selectCity()" name="cityId" class="content  control-label">
                        <option value="0">Tỉnh/ Thành Phố</option>
                        <% lstCity.map((e,i) =>{ %>
                          <option value="<%= e.id %>"><%= e.name %></option>
                        <% }) %>
                        
                        </select>
                        <br>
                      </div>
                      <br>
                      <div class="col-sm-2">
                        <select id="ddlProvinces" name="provinceId" class="content  control-label">
                        <option value="0">Quận/ Huyện</option>
                      </select>
                      </div>
                      <span style="color: red; font-style: italic;" id="valCity"></span>

                    </div>

                    <br>
                    <label class="col-sm-3 control-label">Map</label>
                    <div class="col-sm-9" id="map" style="margin-bottom: 20px; height: 300px">
                    </div>

                    <label for="inputPassword" class="col-sm-3 control-label">Vị trí tọa độ</label>
                    <div class="col-sm-4">
                      <input class="form-control" name="lat" required id="lat" type="text" placeholder="latidude" read-only>
                    </div>
                    <div class="col-sm-4">
                      <input class="form-control" name="lng" required id="lng" type="text" placeholder="longitude" read-only>
                      <br>
                    </div>
                    <label class="col-sm-3 control-label">Mô tả địa điểm</label>
                    <div class="col-sm-9">
                      <textarea rows="3" required="Nhập mô tả địa điểm" id="txtDesPlace" class="form-control" name="txtDesPlace" placeholder="Mô tả địa điểm"></textarea>
                      <span style="color: red; font-style: italic;" id="valDesc"></span>

                    </div>
                    <label class="col-sm-3"></label>
                    <h4 class="col-sm-9 " style="text-align: center; color: black; font-style: italic;font-weight:bold" id="valAddress">
                      Bạn hãy chọn những hình ảnh đẹp mà bạn ăn ý nhất để upload nhé!

                    </h4>
                    <label class="col-sm-3 control-label">Thêm hình ảnh</label>
                    <div class="col-sm-9">
                      <input id="file-3" type="file" name="image" multiple>
                      <br>

                    </div>
                    <div style="margin-bottom: 10px;text-align:right" class="col-sm-12">
                      <input class="btn btn-primary" onClick="return checkInput();" type="submit" value="Gửi bài"/>
                      <a style="margin-left: 10px" class="btn btn-default" href="../">Thoát</a>
                      <br>
                    </div>
                    <br>
                  </div>
                </div>
                
              </div>
            </div>
            <!--// <div class="col-xs-12 col-md-8">
          //   aksdflsad
          // </div>-->
          </div>
        </form>
      </div>
    </div>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" type="text/javascript"></script>
    <script type="text/javascript">
       $("#file-3").fileinput({
          showUpload: false,
          showCaption: false,
          browseClass: "btn btn-primary btn-lg",
          fileType: "any",
          previewFileIcon: "<i class='glyphicon glyphicon-king'></i>",
          overwriteInitial: false,
          initialPreviewAsData: true
      });

    </script>
    <script>
      // In the following example, markers appear when the user clicks on the map.
      // Each marker is labeled with a single alphabetical character.


      var labels = '';
      var labelIndex = 0;
      var markers = [];
      function initAutocomplete() {
        var map = new google.maps.Map(document.getElementById('map'), {
          center: { lat: 10.4561, lng: 106.356 },
          zoom: 13,
          mapTypeId: 'roadmap'
        });
        // new google.maps.Marker({
        //   position: {lat: <?= $mark->latitude ?>, lng:  <?= $mark->longitude ?>},
        //   label: labels[labelIndex++ % labels.length],
        //   map: map  
        // });

        // function initAutocomplete(() {
        //   var bangalore = { lat: 12.97, lng: 77.59 };
        //   var map = new google.maps.Map(document.getElementById('map'), {
        //     zoom: 13,
        //     center: bangalore,
        //     //mapTypeId: 'roadmap'
        //   });

        // This event listener calls addMarker() when the map is clicked.
        google.maps.event.addListener(map, 'click', function (event) {
          addMarker(event.latLng, map);
        });

        var input = document.getElementById('input');

        var searchBox = new google.maps.places.SearchBox(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
        map.addListener('bounds_changed', function () {
          searchBox.setBounds(map.getBounds());
        });

        searchBox.addListener('places_changed', function () {
          var places = searchBox.getPlaces();

          if (places.length == 0) {
            return;
          }

          // Clear out the old markers.
          markers.forEach(function (marker) {
            marker.setMap(null);
          });
          markers = [];

          // For each place, get the icon, name and location.
          var bounds = new google.maps.LatLngBounds();
          places.forEach(function (place) {
            if (!place.geometry) {
              console.log("Returned place contains no geometry");
              return;
            }
            var icon = {
              url: place.icon,
              size: new google.maps.Size(71, 71),
              origin: new google.maps.Point(0, 0),
              anchor: new google.maps.Point(17, 34),
              scaledSize: new google.maps.Size(25, 25)
            };

            // Create a marker for each place.
            markers.push(new google.maps.Marker({
              map: map,
              icon: icon,
              title: place.name,
              position: place.geometry.location
            }));

            if (place.geometry.viewport) {
              // Only geocodes have viewport.
              bounds.union(place.geometry.viewport);
            } else {
              bounds.extend(place.geometry.location);
            }
          });
          map.fitBounds(bounds);
          document.getElementById('lat').value = map.center.lat();
          document.getElementById('lng').value = map.center.lng();
        });


        // Add a marker at the center of the map.
        //addMarker(bangalore, map);
      }

      function checkInput() {
        var name = document.getElementById('txtNamePlace').value;
        var valName = document.getElementById('valName');
        var address = document.getElementById('txtAddress').value;
        var valAddress = document.getElementById('valAddress');
        var desc = document.getElementById('txtDesPlace').value;
        var valDesc = document.getElementById('valDesc');
        var cbClaimb = document.getElementById('cbClaimb').value;
        var seeView = document.getElementById('seeView').value;
        var cbTreckking = document.getElementById('cbTreckking').value;
        var camping = document.getElementById('camping').value;
        var city = document.getElementById('ddlCity').value;
        var valCity = document.getElementById('valCity');
        var ward = document.getElementById('ddlProvinces').value;
        if (name === "") {
          valName.innerHTML = "Nhập tên địa điểm"
          $('html, body').animate({ scrollTop: $('#txtNamePlace').offset().top - 80 }, 1);
          return false;
        }
        else
          if (address === "") {
            valName.innerHTML = "";
            valAddress.innerHTML = "Nhập địa chỉ";
            $('html, body').animate({ scrollTop: $('#txtAddress').offset().top - 80 }, 1);
            return false;
          }
          else
            if (city === '0' || ward === '0') {
              valName.innerHTML = "";
              valAddress.innerHTML = "";
              valCity.innerHTML = "Chọn Thành phố/ Tỉnh sau đó chọn Quận/Huyện";
              $('html, body').animate({ scrollTop: $('#ddlCity').offset().top - 80 }, 1);
              return false;
            }
            else
              if (desc === "") {
                valName.innerHTML = "";
                valAddress.innerHTML = "";
                valCity.innerHTML = "";
                valDesc.innerHTML = "Nhập tên mô tả địa điểm";
                $('html, body').animate({ scrollTop: $('#txtDesPlace').offset().top - 80 }, 1);
                return false;
              }
              else
                return alert(`Cám ơn những chia sẽ của bạn!  Chúc bạn có những hành trình phượt thật là thú vị và khó quên nhé ^^`);
      }
      // Adds a marker to the map.
      function addMarker(location, map) {

        // Add the marker at the clicked location, and add the next-available label
        // from the array of alphabetical characters.
        var marker = new google.maps.Marker({
          position: location,
          label: labels[labelIndex++ % labels.length],
          map: map

        });

        document.getElementById('lat').value = marker.position.lat();
        document.getElementById('lng').value = marker.position.lng();
        deleteMarkers();
        markers.push(marker);
      }
      function setMapOnAll(map) {
        for (var i = 0; i < markers.length; i++) {
          markers[i].setMap(map);
        }
      }

      // Removes the markers from the map, but keeps them in the array.
      function clearMarkers() {
        setMapOnAll(null);
      }
      function deleteMarkers() {
        clearMarkers();
        markers = [];
      }


      //google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAL0C1dheOG0o01S5e9FOTlVasfsAylyes&libraries=places&callback=initAutocomplete"
      async defer></script>
    <script>
      function selectCity() {
        $(document).ready(() => {
          var cityId = document.getElementById("ddlCity").value;
          if (cityId === 0) return;
          var ward = document.getElementById("ddlProvinces");
          $.ajax({
            type: "POST",
            url: 'http://localhost:3000/place/getward',
            data: { id: cityId }, // serializes the form's elements.
            success: function (data) {
              ward.innerHTML = "<option>Quận/ Huyện</option>";
              data.map((e) => {
                ward.innerHTML += `<option value=${e.id}>${e.name}</option>`;
              })
              //console.log(data); // show response from the php script.
            }
          });
        });
      }
    </script>
    <% include ../layout/footer %>